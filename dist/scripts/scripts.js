"use strict";var moment,_;angular.module("angularPlanningApp",[]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]).constant("moment",moment).constant("_",_),angular.module("angularPlanningApp").controller("MainCtrl",["$scope","$q","$location","$anchorScroll","moment",function(a,b,c,d,e){a.currentDate=e(),a.addDays=function(b){a.currentDate.add(b,"days")},a.goToDateString="",a.goToDate=function(){a.currentDate=e(a.goToDateString,"MM/DD/YYYY")},a.onDayHover=function(a,b){console.log("Day hovered",a,b)},a.onDayClick=function(a,b){console.log("Day clicked",a,b)},a.onEventClick=function(a,b,c){console.log("Event clicked",a,b,c)};var f=[{id:1,name:"TV Series",open:!0,childs:[{id:2,name:"Game of Thrones",open:!0,childs:[{id:3,name:"Stark",open:!0,childs:[{id:4,name:"Jon Snow",events:[{id:123,startsAt:e(),endsAt:e().add(4,"days"),color:"yellow",pending:!0,morningIncluded:!1,afternoonIncluded:!1,priority:1}]},{id:5,name:"Sansa Stark",events:[{id:123,startsAt:e().add(10,"days"),endsAt:e().add(12,"days"),color:"purple",pending:!1,morningIncluded:!0,afternoonIncluded:!0,priority:1}]}]},{id:6,name:"Targaryen",open:!0,childs:[{id:7,name:"Daenerys Targaryen",events:[]}]}]},{id:7,name:"Big Bang Theory",open:!0,childs:[{id:8,name:"Sheldon Cooper",events:[{id:123,startsAt:e().add(1,"months"),endsAt:e().add(1,"months").add(4,"days"),color:"pink",pending:!1,morningIncluded:!0,afternoonIncluded:!0,priority:1}]},{id:9,name:"Howard Wolowitz",events:[]}]}]},{id:10,name:"Movies",open:!1,childs:[{id:11,name:"Han Solo",events:[]}]}];a.getResources=function(){var a=b.defer();return setTimeout(function(){a.resolve(f)},1e3),a.promise}}]),angular.module("angularPlanningApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("angularPlanningApp").directive("angularPlanning",function(){return{restrict:"E",scope:{getResources:"&",currentDate:"=",cellWidth:"=",planningResourcesColumnRatio:"=",onDayHover:"&?",onDayClick:"&?",onEventClick:"&?"},templateUrl:"views/angular-planning.html",controller:["$scope","$q","moment","_",function(a,b,c,d){function e(b,c){for(var d=0;d<a.resources.length;d++){var f=a.resources[d];f.parentGroup===b.id&&(f.show=c,f.group===!0&&f.open===!0&&e(f,c))}}function f(a,b){a.group===!0&&(e(a,b),a.open=b)}function g(){for(var b=0;b<a.resources.length;b++)a.resources[b].group===!0&&(null===a.resources[b].parentGroup&&(a.resources[b].show=!0),f(a.resources[b],a.resources[b].open))}function h(a){var b=function(a,c){return d.flatMap(a,function(a){return a.parentGroup=c,a.childs?(a.group=!0,d.concat(a,b(a.childs,a.id))):(a.group=!1,[a])})};return b(a,null)}function i(c,d){var e=b.defer();return a.getResources({minDate:c,maxDate:d}).then(function(a){e.resolve(h(a))}),e.promise}function j(){var b=a.dates.days[0],c=a.dates.days[a.dates.days.length-1],d=i(b,c);d.then(function(b){a.resources=b,g()})}function k(a){for(var b=[],c={month:null,nbDaysDisplayed:0},d=0;d<a.length;d++){var e=a[d].clone().startOf("month");e.isSame(c.month,"month")?c.nbDaysDisplayed++:(c={month:e,nbDaysDisplayed:1},b.push(c))}return b}function l(a){return a.isSame(c(),"day")}this.toggleFolding=f,a.isToday=l,this.isToday=l,this.isEndOfWeek=function(a){return a.clone().endOf("week").isSame(a,"day")},this.isMorningOnly=function(a,b){return b.afternoonIncluded===!1&&b.endsAt.isSame(a,"day")},this.isAfternoonOnly=function(a,b){return b.morningIncluded===!1&&b.startsAt.isSame(a,"day")},this.onDayHover=d.debounce(function(b,c){a.onDayHover&&!c.group&&a.onDayHover({day:b,resource:c})},250),this.onDayClick=function(b,c){a.onDayClick&&!c.group&&a.onDayClick({day:b,resource:c})},this.onEventClick=function(b,c,d,e){a.onEventClick&&!e.group&&a.onEventClick({event:c,day:d,resource:e}),b.stopPropagation()},a.dates={days:[],months:[]},a.nbDaysDisplayed=0,a.planningWidth=0,a.displayDates=function(){for(var b=[],c=a.currentDate.clone(),d=0;d<a.nbDaysDisplayed;d++)b.push(c.clone()),c.add(1,"days");a.dates.days=b,a.dates.months=k(a.dates.days),j()},a.$watch("planningWidth",function(b,c){b!==c&&(a.nbDaysDisplayed=d.floor(b*(1-a.planningResourcesColumnRatio/100)/a.cellWidth),a.displayDates())}),a.$watch("currentDate",function(b,c){b!==c&&a.displayDates()},!0),a.displayDates()}]}}),angular.module("angularPlanningApp").directive("angularPlanningResourceRow",function(){return{require:"^^angularPlanning",restrict:"A",scope:{resource:"=",dates:"="},link:function(a,b,c,d){a.planningController=d},templateUrl:"views/angular-planning-resource-row.html"}}),angular.module("angularPlanningApp").directive("resizeDetect",["_","$window",function(a,b){return{restrict:"A",scope:{watchedWidth:"="},link:function(c,d){c.watchedWidth=d[0].offsetWidth,b.onresize=a.debounce(function(){c.$apply(function(){c.watchedWidth=d[0].offsetWidth})},100)}}}]),angular.module("angularPlanningApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/angular-planning-resource-row.html",'<th class="planning-resources" ng-class="{\'planning-group-toggle\': resource.group}" ng-click="planningController.toggleFolding(resource, !resource.open)"> <div class="planning-resource-name"> <i class="fa" ng-if="resource.group" ng-class="{\'fa-caret-down\': resource.open, \'fa-caret-right\': !resource.open}"></i> <span ng-bind="resource.name"></span> </div> </th> <td class="planning-day-cell" ng-class="{\'planning-day-cell-end-of-week\': planningController.isEndOfWeek(day), \'planning-today-cell\': planningController.isToday(day)}" ng-repeat="day in dates.days track by $index" ng-mouseover="planningController.onDayHover(day, resource)" ng-click="planningController.onDayClick(day, resource)"> <span class="planning-day-event" ng-repeat="event in resource.events" ng-if="day.isSameOrAfter(event.startsAt, \'day\') && day.isSameOrBefore(event.endsAt, \'day\')" ng-style="{\n      background: planningController.isMorningOnly(day, event) ? \'linear-gradient(to right bottom, \' + event.color + \' 50%, rgba(255, 255, 255, 0) 50%)\' : (planningController.isAfternoonOnly(day, event) ? \'linear-gradient(to right bottom, rgba(255, 255, 255, 0) 50%, \' + event.color + \' 50%)\' : event.color) }" ng-click="planningController.onEventClick($event, event, day, resource)"> <i class="fa fa-hourglass-half" ng-if="event.pending"></i> </span> </td>'),a.put("views/angular-planning.html",'<div class="planning-wrapper"> <table class="planning-table" resize-detect watched-width="planningWidth"> <thead class="planning-table-header"> <tr> <th class="planning-resources"></th> <th class="planning-month" ng-repeat="month in dates.months track by $index" ng-attr-colspan="{{ month.nbDaysDisplayed }}"> <span ng-bind="month.month.format(\'MMMM YYYY\')"></span> </th> </tr> <tr> <th class="planning-resources"></th> <th ng-repeat="day in dates.days track by $index" ng-bind="day.format(\'DD\')" ng-class="{\'planning-today-cell\': isToday(day) }"></th> </tr> </thead> <tbody> <tr angular-planning-resource-row ng-repeat="resource in resources" resource="resource" dates="dates" ng-class="{\'planning-group-row\': resource.group}" ng-show="resource.show"></tr> </tbody> </table> </div>'),a.put("views/main.html",'<div class="row marketing"> <div class="row"> <div class="col-sm-3"> <div class="btn-group"> <button type="button" class="btn btn-default" ng-click="addDays(-7)">7 days before</button> <button type="button" class="btn btn-default" ng-click="addDays(7)">7 days after</button> </div> </div> <div class="col-sm-3"> <div class="input-group"> <input type="text" class="form-control" placeholder="MM/DD/YYYY" ng-model="goToDateString"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-click="goToDate()">Go to</button> </span> </div> </div> </div> <angular-planning current-date="currentDate" get-resources="getResources(minDate, maxDate)" on-day-hover="onDayHover(day, resource)" on-day-click="onDayClick(day, resource)" on-event-click="onEventClick(event, day, resource)" cell-width="20" planning-resources-column-ratio="25"></angular-planning> </div>')}]);