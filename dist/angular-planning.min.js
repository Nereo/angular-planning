var moment,_;angular.module("angularPlanningApp",[]).constant("moment",moment).constant("_",_),angular.module("angularPlanningApp").directive("angularPlanning",function(){return{restrict:"E",scope:{getEvents:"&",resources:"=",currentDate:"=",cellWidth:"=",planningResourcesColumnRatio:"=",showDayOfWeek:"=",onDayHover:"&?",onDayClick:"&?",onEventClick:"&?"},templateUrl:"angular-planning/views/angular-planning.html",controller:["$scope","$q","moment","_",function(n,e,t,a){function o(e,t){for(var a=0;a<n.flattenedResources.length;a++){var r=n.flattenedResources[a];r.parentGroup===e.id&&(r.show=t,r.group===!0&&r.open===!0&&o(r,t))}}function r(n,e){n.group===!0&&(o(n,e),n.open=e)}function i(){for(var e=0;e<n.flattenedResources.length;e++)n.flattenedResources[e].group===!0&&(null===n.flattenedResources[e].parentGroup&&(n.flattenedResources[e].show=!0),r(n.flattenedResources[e],n.flattenedResources[e].open))}function s(n){var e=function(n,t){return a.flatMap(n,function(n){return n.parentGroup=t,n.children?(n.group=!0,a.concat(n,e(n.children,n.id))):(n.group=!1,[n])})};return e(n,null)}function l(n){for(var e=[],t={month:null,nbDaysDisplayed:0},a=0;a<n.length;a++){var o=n[a].clone().startOf("month");o.isSame(t.month,"month")===!1?(t={month:o,nbDaysDisplayed:1},e.push(t)):t.nbDaysDisplayed++}return e}function u(n){return n.isSame(t(),"day")}function c(n){return n.clone().endOf("week").isSame(n,"day")}function d(){var e=n.dates.days[0],t=n.dates.days[n.dates.days.length-1],a=n.getEvents({minDate:e,maxDate:t});a.then(function(e){n.events=e})}this.toggleFolding=r,n.$watchCollection("resources",function(e){n.flattenedResources=s(e),i()}),n.isToday=u,this.isToday=u,n.isEndOfWeek=c,this.isEndOfWeek=c,this.isMorningOnly=function(n,e){return e.afternoonIncluded===!1&&e.endsAt.isSame(n,"day")},this.isAfternoonOnly=function(n,e){return e.morningIncluded===!1&&e.startsAt.isSame(n,"day")},this.onDayHover=a.debounce(function(e,t){n.onDayHover&&!t.group&&n.onDayHover({day:e,resource:t})},250),this.onDayClick=function(e,t){n.onDayClick&&!t.group&&n.onDayClick({day:e,resource:t})},this.onEventClick=function(e,t,a,o){n.onEventClick&&!o.group&&n.onEventClick({event:t,day:a,resource:o}),e.stopPropagation()},n.dates={days:[],months:[]},n.nbDaysDisplayed=0,n.planningWidth=0,n.displayDates=function(){for(var e=[],t=n.currentDate.clone(),a=0;a<n.nbDaysDisplayed;a++)e.push(t.clone()),t.add(1,"days");n.dates.days=e,n.dates.months=l(n.dates.days),d()},n.$watch("planningWidth",function(e,t){e!==t&&(n.nbDaysDisplayed=a.floor(e*(1-n.planningResourcesColumnRatio/100)/n.cellWidth),n.displayDates())}),n.$watch("currentDate",function(e,t){e!==t&&n.displayDates()},!0)}]}}),angular.module("angularPlanningApp").directive("angularPlanningResourceRow",function(){return{require:"^^angularPlanning",restrict:"A",scope:{resource:"=",events:"=",dates:"="},link:function(n,e,t,a){n.planningController=a},templateUrl:"angular-planning/views/angular-planning-resource-row.html"}}),angular.module("angularPlanningApp").directive("resizeDetect",["_","$window",function(n,e){return{restrict:"A",scope:{watchedWidth:"="},link:function(t,a){t.watchedWidth=a[0].offsetWidth,e.onresize=n.debounce(function(){t.$apply(function(){t.watchedWidth=a[0].offsetWidth})},100)}}}]);